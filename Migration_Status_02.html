<!DOCTYPE html>
<html>
<head>
	<title>Migration Status</title>
	<!--<link rel="stylesheet" href="styles.css">-->
<div>
	<h3> M I G R A T I O N  -  S T A T U S </h3>
</div>
	<meta charset="utf-8">
	<script src="https://sdk.amazonaws.com/js/aws-sdk-2.208.0.min.js"></script>
	<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>


</head>
<body>
	<p>Select Filters to get your ec2 graph :</p>
<form>
		<div class = "css-grid1">
			<label> Launch-time: </label>
		</div>
		<div class = "css-inlineblock1">
			<label for="fromdate">From Date:</label>
			<input type="date" id="fromdate" name="fromdate" min="2017-01-01">
			<label for="todate">To Date:</label>
			<input type="date" id="todate" name="todate">
		</div>
		<div class = "css-button">
			<input type="submit" id="sbmt" onclick="applyFilters(); return false;">
		</div>

		<div id="myDiv" style="width: 480px; height: 400px;"><!-- Plotly chart will be drawn inside this DIV --></div>

</form>
<script>
var ec2 = new AWS.EC2();
AWS.config.update({
	region: "us-east-1",
	accessKeyId: "AKIAI35YVDRTSJ47FJZA",
	secretAccessKey: "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"
});
function applyFilters() {
		var listDate = [];
		//demo1.innerHTML = '';
		var startDate = document.getElementById("fromdate").value;
		var endDate = document.getElementById("todate").value;
		//alert(startDate);
		//alert(endDate);
		var dateMove = new Date(startDate);
		var strDate = startDate;
		while (strDate < endDate){
  			var strDate = dateMove.toISOString().slice(0,10);
				listDate.push(strDate);
  			dateMove.setDate(dateMove.getDate()+1);
		};
		//alert(listDate);
		//document.getElementById('demo1').innerHTML = "Your selected dates are";
		//demo2.innerHTML += "<br>";
		//document.getElementById('demo3').innerHTML = listDate;
		//alert(listDate);
		//var i = 0;
		var j = listDate.length;
		//alert(j);
		var instArray = [];
		//while (i < j){
			for (var i = 0; i < j; i++) {
			//alert(i);
			//alert(listDate[i]);
			var hourArray = [];

			var d = listDate[i];

			for (var m = 0; m <= 2; m++) {
				hourArray.push(d + 'T' + m + '*');
			}
			//alert(hourArray);
			var ec2 = new AWS.EC2();
			AWS.config.update({
				region: "us-east-1",
				accessKeyId: "AKIAI35YVDRTSJ47FJZA",
				secretAccessKey: "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"
			});
			
			var params = {
				Filters: [
				{
				Name: 'launch-time',
				Values: hourArray
				}]
			};

			var resp = ec2.describeInstances(params).send(); null
			alert(resp.data);
			var no_of_inst = resp.data.Reservations.length;
			instArray.push(no_of_inst);
			var trace = {
  				x: listDate,
  				y: instArray,
  				type: 'line'
				};
			Plotly.newPlot('myDiv', trace);
		}
			//i = i + 1;
}
</script>
</body>
</html>
