<!DOCTYPE html>
<html>
<head>
	<title>Migration Status</title>
	<!--<link rel="stylesheet" href="styles.css">-->
<div>
	<h3> M I G R A T I O N  -  S T A T U S </h3>
</div>
	<meta charset="utf-8">
	<script src="https://sdk.amazonaws.com/js/aws-sdk-2.208.0.min.js"></script>
	<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
	<p>Select Filters to get your ec2 graph :</p>
<form>
		<div class = "css-grid1">
			<label> Launch-time: </label>
		</div>
		<div class = "css-inlineblock1">
			<label for="fromdate">From Date:</label>
			<input type="date" id="fromdate" name="fromdate" min="2017-01-01">
			<label for="todate">To Date:</label>
			<input type="date" id="todate" name="todate">
		</div>
		<div class = "css-button">
			<input type="submit" id="sbmt" onclick="applyFilters(); return false;">
		</div>
		<div id="myDiv" style="width: 480px; height: 400px;"><!-- Plotly chart will be drawn inside this DIV --></div>
</form>
<script>
AWS.config.update({
	region: "us-east-1",
	accessKeyId: "AKIAI35YVDRTSJ47FJZA",
	secretAccessKey: "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"
});
var ec2 = new AWS.EC2();

//var ec2DesribePromise = ec2.describeInstances(params).promise();
function getDates(){
		var listDate = [];
		//demo1.innerHTML = '';
		var startDate = document.getElementById("fromdate").value;
		var endDate = document.getElementById("todate").value;
		var dateMove = new Date(startDate);
		var strDate = startDate;
		while (strDate < endDate){
  			var strDate = dateMove.toISOString().slice(0,10);
				listDate.push(strDate);
  			dateMove.setDate(dateMove.getDate()+1);
		};
		return listDate;
	}
		//alert(listDate);
		var i = 0;
		var instArray = [];
		var dates = getDates();
		var j = dates.length;
		//alert(j);
		while (i < j){

			//alert(i);
			//alert(listDate[i]);
			var hourArray = [];
			var d = dates[i];
			i = i + 1;
			for (var m = 0; m <= 2; m++) {
				hourArray.push(d + 'T' + m + '*');
			}



			AWS.config.update({
				region: "us-east-1",
				accessKeyId: "AKIAI35YVDRTSJ47FJZA",
				secretAccessKey: "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"
			});
			var ec2 = new AWS.EC2();

			if (typeof Promise === 'undefined') {
			  AWS.config.setPromisesDependency(require('bluebird'));
			}

		var describeInstances = function describeInstances() {

			var params = {
				Filters: [
				{
				Name: 'launch-time',
				Values: hourArray
				}]
			};
			return ec2.describeInstances(params).promise();
		};

		describeInstances()
			.then(function(data){
				var no_of_inst = data.Reservations.length;
				//alert("Instances migrated on " + JSON.stringify(params.Filters[0].Values[0]) + " are: " + no_of_inst);
				instArray.push(no_of_inst);

			})
			.catch(function(err) {
				console.log(err);
			});
	}


</script>
</body>
</html>
